<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <title>poolPi</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="mobile-web-app-capable" content="yes" />
        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
		
		<script src="js/vendor/jquery-1.11.3.min.js"></script>
		<script src="js/vendor/hammer.min.js"></script>
		<script src="js/vendor/jquery.hammer.js"></script>
		<script src="js/plugins.js"></script>
		<script src="js/main.js"></script>
		
		<script type="text/javascript">
			var control = {
				ignore: [],
				IPEuromatik: 195,
				IPColor: 174,
				IPAttraktion: 185,
				
				redeemer: function(target, id, value, onSuccess){
					//console.log(control);
					//console.log(value);
					
					if(control.ignore[target+"_"+id])
						return;
					
					var audio = new Audio('./res/confirm.mp3');
					audio.play();
					
					control.ignore[target+"_"+id] = true;
					
					$.ajax({
						url: "redeemer.php?control="+target+"&id="+id+"&value="+value,
						success: function (data, textStatus, jqXHR) {
							//console.log(data);
							onSuccess();
							
							window.setTimeout(function(){
								control.ignore[target+"_"+id] = false;
							}, 1000);
						}
					});

				},
				
				update: function(v, delay){
					if(typeof delay == "undefined")
						delay = 500;
					
					window.setTimeout(function(){
						$.ajax({
							dataType: "json",
							url: "proxy.php?control="+control["IP"+$(v).data("server")],
							success: function(data) {
								$(v).prop("src", "./img/"+data[$(v).data("master")]);

								var status = "off";
								if(data[$(v).data("master")].indexOf("_run") > 0)
									status = "on";

								if(data[$(v).data("master")].indexOf("_on") > 0)
									status = "on";

								if(data[$(v).data("master")].indexOf("-1") > 0)
									status = "on";

								$(v).data("status", status);
							}
						});
					}, delay);
				},
				
				tap: function(e){
					control.redeemer(control["IP"+e.data("server")], e.data("master"), typeof e.data("value") !== "undefined" ? e.data("value") : 'i',  function(){
						control.update(e);

						if(e.data("update")){
							var u = e.data("update").split(",");
							u.forEach(function(k, v){
								$("[data-group="+k+"]").each(function(sk, sv){
									if($(sv).data("group-delay")){
										if($(sv).data("group-delayif") && $(sv).data("group-delayif") == $(sv).data("status"))
											control.update(sv, $(sv).data("group-delay") * 1000);
										else
											control.update(sv);

									} else
										control.update(sv);
								});

							});
						}
					});
				},
				
				value: function(e){
					$.ajax({
						dataType: "json",
						url: "proxy.php?control="+control["IP"+$(e).data("server")],
						success: function (data, textStatus, jqXHR) {
							$(e).html(data[$(e).data("master")]);
							//onSuccess();
						}
					});
				}
			};
			
			
			$(function(){
				document.ontouchmove = function(event){
					event.preventDefault();
				}

				/*$(".touch").hammer().bind("tap", function(ev) {
					console.log(ev);
				});*/
				
				$(".touch").bind("mousedown touchstart", function(ev) {
					$(ev.target).css("opacity", ".5");
				});
				
				$(".touch").bind("mouseup touchend", function(ev) {
					$(ev.target).css("opacity", "1");
				});
				
				$(".label").bind("mousedown touchstart", function(ev) {
					$(ev.target).parent().css("opacity", ".5");
				});
				
				$(".label").bind("mouseup touchend", function(ev) {
					$(ev.target).parent().css("opacity", "1");
				});
				
				
				$('.manual').each(function(k, v){
					//control.update(v);
					
					$(v).hammer().bind("tap", {threshold: 20}, function(ev) {
						var e = $(ev.target);
						control.redeemer(control["IP"+e.data("server")], e.data("master"), e.data("value"),  function(){
							//control.update(ev.target);
						});
						
					});
				});
				
				$('.load').each(function(k, v){
					control.update(v);
					
					$(v).hammer().bind("tap", function(ev) {
						control.tap($(ev.target));
					});
				});
				
				$('.load + .label').each(function(k, v){
					$(v).hammer().bind("tap", function(ev) {
						control.tap($(ev.target).prev());
					});
				});
				
				$('.value').each(function(k, v){
					control.value(v);
					window.setInterval(function(){
						control.value(v);
					}, 60000);
				});
			});

		</script>
		
		<style type="text/css">
			body {
				margin-top:2em;
				color:white;
			}
			
			.touch {
				cursor: pointer;
				height:120px;
				width:180px;
			}
			
			.label {
				height:80px;
				margin-top:-80px;
				padding-left:10px;
				padding-right:10px;
				cursor: pointer;
				font-size:2em;
				text-align:center;
				width:180px;
				box-sizing: border-box;
				color:black;
			}
			
			.inline {
				display:inline-block;
				vertical-align: top;
			}
			
			.value {
				width:180px;
				height:120px;
				font-weight:bold;
				font-size:4em;
				text-align:right;
				box-sizing: border-box;
				padding-top:5px;
			}
			
			.inline span {
				padding-left:5px;
			}
		</style>
    </head>
    <body>
		<div>
			<img class="touch manual" data-server="Euromatik" data-master="0033" data-value="1" src="./img/abdzu-0.gif" />
			<img class="touch manual" data-server="Euromatik" data-master="0033" data-value="0" src="./img/abdstop.gif" />
			<img class="touch manual" data-server="Euromatik" data-master="0033" data-value="2" src="./img/abdauf-0.gif" />
		</div>
		
		<div style="margin-top:4em;">
			<img class="touch load" data-server="Attraktion" data-master="0017" src="./img/dsnone.gif" />
			<img class="touch load" data-server="Attraktion" data-master="0018" src="./img/dsnone.gif" />
			<img class="touch load" data-server="Attraktion" data-master="0021" src="./img/dsnone.gif" />
		</div>
		
		<div style="margin-top:4em;">
			<img class="touch load" data-server="Color" data-group="light" data-update="colors,light" data-master="0008" src="./img/dsnone.gif" />
			<img class="touch load" data-server="Color" data-group="light" data-group-delay="7" data-group-delayif="on" data-master="0009" src="./img/dsnone.gif" />
			
			<div class="inline">
				<span>Wassertemperatur</span>
				<div class="value" data-master="0100" data-server="Euromatik"></div>
			</div>
		</div>
		
		<div style="margin-top:1em;">
			<div class="inline">
				<img class="touch load" data-group="colors" data-server="Color" data-master="0101" data-update="colors,light" src="./img/dsnone.gif" />
				<div class="label">Bunt <span style="color:grey">2</span></div>
			</div>
			<div class="inline">
				<img class="touch load" data-group="colors" data-server="Color" data-master="0110" data-update="colors,light" src="./img/dsnone.gif" />
				<div class="label">Grün <span style="color:grey">11</span></div>
			</div>

			<div class="inline">
				<img class="touch load" data-group="colors" data-server="Color" data-master="0111" data-update="colors,light" src="./img/dsnone.gif" />
				<div class="label">Blau <span style="color:grey">12</span></div>
			</div>
			
			<div class="inline">
				<img class="touch load" data-group="colors" data-server="Color" data-master="0113" data-update="colors,light" src="./img/dsnone.gif" />
				<div class="label">Pastell<span style="color:grey">14</span></div>
			</div>
			
			<div class="inline">
				<img class="touch load" data-group="colors" data-server="Color" data-master="0113" data-update="colors,light" src="./img/dsnone.gif" />
				<div class="label">Weiß<span style="color:grey">15</span></div>
			</div>
		</div>

		

    </body>
</html>
